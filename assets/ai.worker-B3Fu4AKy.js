(function(){"use strict";var E=(n=>(n[n.None=0]="None",n[n.Black=1]="Black",n[n.White=2]="White",n[n.Obstacle=3]="Obstacle",n))(E||{}),M=(n=>(n.Easy="easy",n.Medium="medium",n.Hard="hard",n))(M||{});const H=n=>{const t=n.length,a=new Int8Array(t*t);for(let o=0;o<t;o++)for(let e=0;e<t;e++)a[o*t+e]=n[o][e];return a},v=(n,t,a)=>n*a+t,w=(n,t)=>({r:Math.floor(n/t),c:n%t}),k={},O=n=>{if(k[n])return;const t=[],a=[[-1,0],[1,0],[0,-1],[0,1]];for(let o=0;o<n;o++)for(let e=0;e<n;e++){const i=v(o,e,n);t[i]=[],a.forEach(([u,c],l)=>{const f=o+u,r=e+c;f>=0&&f<n&&r>=0&&r<n?t[i][l]=v(f,r,n):t[i][l]=-1})}k[n]=t},A=(n,t,a,o,e)=>{const i=[a];e[a]=1;let u=0;const c=k[t];for(;u<i.length;){const l=i[u++];if(o===1){let f=!0,r=l;for(;r=c[r][0],r!==-1;)if(n[r]!==0){f=!1;break}if(f)return!0;for(f=!0,r=l;r=c[r][1],r!==-1;)if(n[r]!==0){f=!1;break}if(f)return!0}else{let f=!0,r=l;for(;r=c[r][2],r!==-1;)if(n[r]!==0){f=!1;break}if(f)return!0;for(f=!0,r=l;r=c[r][3],r!==-1;)if(n[r]!==0){f=!1;break}if(f)return!0}for(let f=0;f<4;f++){let r=l;for(;r=c[r][f],r!==-1;){const s=n[r];if(s!==0){s===o&&e[r]===0&&(e[r]=1,i.push(r));break}}}}return!1},p=(n,t,a,o)=>{const e=Math.floor(a/t),i=a%t,u=[[0,1],[1,0],[1,1],[1,-1]];for(const[c,l]of u){let f=1,r=e+c,s=i+l;for(;r>=0&&r<t&&s>=0&&s<t&&n[r*t+s]===o;)f++,r+=c,s+=l;for(r=e-c,s=i-l;r>=0&&r<t&&s>=0&&s<t&&n[r*t+s]===o;)f++,r-=c,s-=l;if(f>=4)return!0}return!1},I=(n,t,a,o)=>{if(n[a]!==0||p(n,t,a,o))return null;const e=new Int8Array(n);e[a]=o;const i=o===1?2:1,u=new Uint8Array(t*t);for(let c=0;c<t*t;c++)e[c]===i&&(u.fill(0),A(e,t,c,i,u)||(e[c]=0));return u.fill(0),A(e,t,a,o,u)?e:null},g=(n,t,a)=>{let o=0;const e=t/2;for(let i=0;i<t;i++)for(let u=0;u<t;u++){const c=v(i,u,t),l=n[c];if(l===0||l===3)continue;const f=Math.abs(i-e)+Math.abs(u-e),r=t-f;l===a?o+=100+r:o-=100+r}return o},S=(n,t,a)=>{const o=new Set,e=k[t];(t===13?[[3,3],[3,9],[9,3],[9,9],[6,6]]:[[3,3],[3,8],[8,3],[8,8]]).forEach(([c,l])=>{const f=v(c,l,t);n[f]===0&&o.add(f)});for(let c=0;c<t*t;c++)if(n[c]!==0&&n[c]!==3){const l=Math.floor(c/t),f=c%t;for(let r=-1;r<=1;r++)for(let s=-1;s<=1;s++){if(r===0&&s===0)continue;const h=l+r,m=f+s;if(h>=0&&h<t&&m>=0&&m<t){const d=v(h,m,t);n[d]===0&&o.add(d)}}[0,1,2,3].forEach(r=>{let s=c,h=e[s][r];if(h!==-1&&n[h]===0){s=h;for(let m=0;m<3&&(s=e[s][r],s!==-1&&n[s]===0);m++)o.add(s)}})}const u=t/2;return Array.from(o).sort((c,l)=>{const f=Math.abs(Math.floor(c/t)-u)+Math.abs(c%t-u),r=Math.abs(Math.floor(l/t)-u)+Math.abs(l%t-u);return f-r})},B=(n,t,a,o,e,i,u)=>{if(a===0)return g(n,t,u);const c=S(n,t);if(c.length===0)return g(n,t,u);if(i){let l=-1/0;for(const f of c){const r=I(n,t,f,u);if(!r)continue;const s=B(r,t,a-1,o,e,!1,u);if(l=Math.max(l,s),o=Math.max(o,s),e<=o)break}return l}else{const l=u===1?2:1;let f=1/0;for(const r of c){const s=I(n,t,r,l);if(!s)continue;const h=B(s,t,a-1,o,e,!0,u);if(f=Math.min(f,h),e=Math.min(e,h),e<=o)break}return f}},F=async(n,t,a)=>{const o=n.length;O(o);const e=H(n),i=t===E.Black?1:2,u=g(e,o,i);let c=1;a===M.Easy&&(c=1),a===M.Medium&&(c=2),a===M.Hard&&(c=3);const l=S(e,o);let f=-1,r=-1/0;if(a===M.Easy&&l.length>0&&Math.random()<.3){const s=Math.floor(Math.random()*Math.min(5,l.length));return w(l[s],o)}for(const s of l){const h=I(e,o,s,i);if(!h)continue;let m=0;const d=i===1?2:1;for(let x=0;x<o*o;x++)h[x]===d&&m++;if(m===0)return w(s,o);const C=B(h,o,c-1,-1/0,1/0,!1,i);C>r&&(r=C,f=s)}return f===-1||a===M.Hard&&r<u-20?null:w(f,o)};self.onmessage=async n=>{const{board:t,player:a,difficulty:o}=n.data,e=await F(t,a,o);self.postMessage(e)}})();
